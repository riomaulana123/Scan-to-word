<script>
  // Fungsi untuk merapikan teks hasil OCR
  function cleanOCRText(text) {
    return text
      // Gabungkan spasi berlebihan
      .replace(/\s+/g, ' ')
      // Rapikan baris
      .replace(/ \n/g, '\n')
      // Maksimal 2 enter
      .replace(/\n{3,}/g, '\n\n')
      // Hapus spasi sebelum tanda baca
      .replace(/\s([.,!?;:])/g, '$1')
      // Hapus spasi di awal & akhir
      .trim();
  }

  // Fungsi scan gambar ke teks
  function scanImage() {
    const imageInput = document.getElementById("imageInput");
    const status = document.getElementById("status");
    const result = document.getElementById("result");

    if (imageInput.files.length === 0) {
      alert("Pilih foto dulu!");
      return;
    }

    status.innerText = "⏳ Sedang memproses OCR...";
    result.value = "";

    Tesseract.recognize(
      imageInput.files[0],
      'ind+eng',
      {
        logger: m => {
          if (m.status === "recognizing text") {
            status.innerText = `⏳ Proses: ${Math.round(m.progress * 100)}%`;
          }
        }
      }
    ).then(({ data: { text } }) => {
      const cleanedText = cleanOCRText(text);
      result.value = cleanedText;
      status.innerText = "✅ OCR selesai & teks dirapikan otomatis";
    }).catch(err => {
      status.innerText = "❌ Gagal memproses gambar";
      console.error(err);
    });
  }
</script>
