<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart OCR Lens</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --primary:#2563eb;
  --glass:rgba(255,255,255,.6);
}
*{box-sizing:border-box}
body{
  margin:0;
  padding:12px;
  font-family:system-ui;
  background:radial-gradient(circle at top,#dbeafe,#eff6ff 60%);
}
.container{max-width:720px;margin:auto}
header{text-align:center}
.glass{
  background:var(--glass);
  backdrop-filter:blur(16px);
  border-radius:18px;
  padding:12px;
  margin-bottom:12px;
  box-shadow:0 20px 40px rgba(0,0,0,.1);
}
#imageContainer{
  position:relative;
  border-radius:16px;
  overflow:hidden;
  background:#000;
}
#image{width:100%;display:block}
#selection{
  position:absolute;
  border:2px solid #22d3ee;
  background:rgba(34,211,238,.25);
  display:none;
  border-radius:6px;
}
input,button{
  width:100%;
  padding:14px;
  border-radius:14px;
  font-size:16px;
  border:none;
}
button{
  background:var(--primary);
  color:white;
  font-weight:700;
}
.actions{display:grid;grid-template-columns:1fr 1fr;gap:8px}
#status{text-align:center;font-size:14px}
textarea{
  width:100%;
  height:90px;
  border-radius:12px;
  padding:10px;
}
#editor{height:240px;border-radius:12px}
.loading{animation:pulse 1s infinite}
@keyframes pulse{0%{opacity:.4}50%{opacity:1}100%{opacity:.4}}
</style>
</head>

<body>
<div class="container">

<header>
<h1>‚ú® Smart OCR Lens</h1>
<p>Scan ‚Ä¢ Blok ‚Ä¢ Edit ‚Ä¢ Download</p>
</header>

<div class="glass">
<input type="file" accept="image/*" id="imageInput">
</div>

<div class="glass">
<div id="imageContainer">
<img id="image">
<div id="selection"></div>
</div>
</div>

<div class="glass">
<button onclick="scanArea()">üîç Scan Area</button>
<div class="actions">
<button onclick="exportWord()">‚¨áÔ∏è Word</button>
<button onclick="exportPDF()">‚¨áÔ∏è PDF</button>
</div>
<div id="status">Menyiapkan OCR‚Ä¶</div>
</div>

<div class="glass">
<textarea id="ocrResult" placeholder="Teks mentah (opsional)"></textarea>
</div>

<div class="glass">
<div id="editor"></div>
</div>

</div>

<script>
const img=document.getElementById("image");
const container=document.getElementById("imageContainer");
const selection=document.getElementById("selection");
const statusText=document.getElementById("status");
const ocrResult=document.getElementById("ocrResult");
const quill=new Quill('#editor',{theme:'snow'});

let startX=0,startY=0,selecting=false;
let worker;

(async()=>{
  worker=await Tesseract.createWorker();
  await worker.loadLanguage("ind+eng");
  await worker.initialize("ind+eng");
  statusText.innerText="OCR siap üöÄ";
})();

imageInput.onchange=e=>{
  img.src=URL.createObjectURL(e.target.files[0]);
};

function pos(e){
  const r=container.getBoundingClientRect();
  const p=e.touches?e.touches[0]:e;
  return{x:p.clientX-r.left,y:p.clientY-r.top};
}

container.onmousedown=container.ontouchstart=e=>{
  selecting=true;
  const p=pos(e);
  startX=p.x;startY=p.y;
  selection.style.display="block";
};

container.onmousemove=container.ontouchmove=e=>{
  if(!selecting)return;
  const p=pos(e);
  selection.style.left=Math.min(startX,p.x)+"px";
  selection.style.top=Math.min(startY,p.y)+"px";
  selection.style.width=Math.abs(p.x-startX)+"px";
  selection.style.height=Math.abs(p.y-startY)+"px";
};

container.onmouseup=container.ontouchend=()=>selecting=false;

async function scanArea(){
  if(selection.offsetWidth<10)return alert("Blok area teks dulu");
  statusText.innerText="üîß Memperbaiki gambar‚Ä¶";
  statusText.classList.add("loading");

  const sx=img.naturalWidth/img.clientWidth;
  const sy=img.naturalHeight/img.clientHeight;
  const x=selection.offsetLeft*sx;
  const y=selection.offsetTop*sy;
  const w=selection.offsetWidth*sx;
  const h=selection.offsetHeight*sy;

  const c=document.createElement("canvas");
  const scale=2;
  c.width=w*scale;
  c.height=h*scale;
  const ctx=c.getContext("2d");
  ctx.drawImage(img,x,y,w,h,0,0,c.width,c.height);

  let imgData=ctx.getImageData(0,0,c.width,c.height);
  let d=imgData.data;
  let min=255,max=0;

  for(let i=0;i<d.length;i+=4){
    let g=d[i]*0.3+d[i+1]*0.59+d[i+2]*0.11;
    d[i]=d[i+1]=d[i+2]=g;
    min=Math.min(min,g);
    max=Math.max(max,g);
  }

  let range=max-min||1;
  for(let i=0;i<d.length;i+=4){
    let v=((d[i]-min)/range)*255;
    v=v>140?255:0;
    d[i]=d[i+1]=d[i+2]=v;
  }
  ctx.putImageData(imgData,0,0);

  statusText.innerText="üîç OCR berjalan‚Ä¶";

  const {data}=await worker.recognize(c);
  const text=data.text.replace(/\n{2,}/g,"\n").trim();

  ocrResult.value+=text+"\n";
  quill.insertText(quill.getLength(),text+"\n");

  statusText.innerText="‚úÖ Selesai";
  statusText.classList.remove("loading");
}

function exportWord(){
  const text=quill.getText().trim();
  if(!text)return alert("Teks kosong");
  const doc=new docx.Document({
    sections:[{children:text.split("\n").map(p=>new docx.Paragraph(p))}]
  });
  docx.Packer.toBlob(doc).then(b=>saveAs(b,"hasil-ocr.docx"));
}

function exportPDF(){
  const {jsPDF}=window.jspdf;
  const text=quill.getText().trim();
  if(!text)return alert("Teks kosong");
  const pdf=new jsPDF();
  pdf.text(pdf.splitTextToSize(text,180),10,10);
  pdf.save("hasil-ocr.pdf");
}
</script>

</body>
</html>
