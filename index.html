<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart OCR Lens ‚Äì Word Full Edition</title>

<!-- OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<!-- WORD-LIKE EDITOR -->
<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js"></script>

<!-- EXPORT -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.min.js"></script>

<style>
body{
  margin:0;
  padding:12px;
  font-family:system-ui,Arial;
  background:#e9edf2
}
.container{max-width:1100px;margin:auto}
.card{
  background:#fff;
  padding:14px;
  border-radius:14px;
  margin-bottom:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.1)
}
button{
  padding:12px;
  border:none;
  border-radius:10px;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
  margin-top:6px
}
.primary{background:#0d6efd;color:#fff}
.success{background:#198754;color:#fff}
.warning{background:#fd7e14;color:#fff}
.gray{background:#adb5bd}
.row{display:flex;gap:8px}
.row button{flex:1}
.hidden{display:none}

#imageContainer{
  position:relative;
  background:#000;
  border-radius:12px;
  overflow:hidden;
}
#image{width:100%}
#selection{
  position:absolute;
  border:2px dashed #00e5ff;
  background:rgba(0,229,255,.25);
  display:none
}
#status{text-align:center;font-size:14px}
</style>
</head>

<body>
<div class="container">

<h2>üì∏ Smart OCR Lens ‚Äî Word Full Edition</h2>

<div class="card">
  <input type="file" accept="image/*" id="imageInput">
</div>

<div class="card">
  <div id="imageContainer">
    <img id="image">
    <div id="selection"></div>
  </div>
</div>

<div class="card">
  <button id="scanBtn" class="primary hidden" onclick="scanArea()">üîç Scan Area</button>
  <div class="row">
    <button class="success" onclick="scanFull()">üìÑ Scan Full</button>
    <button class="gray" onclick="resetAll()">‚ôªÔ∏è Reset</button>
  </div>
  <div id="status">‚è≥ Menyiapkan OCR‚Ä¶</div>
</div>

<div class="card">
  <button class="warning" onclick="formatMakalah()">üìò Format Makalah</button>
</div>

<div class="card">
  <textarea id="editor"></textarea>
</div>

<div class="card row">
  <button class="success" onclick="downloadPDF()">‚¨áÔ∏è PDF</button>
  <button class="primary" onclick="downloadDOCX()">‚¨áÔ∏è Word (.docx)</button>
</div>

</div>

<script>
/* ===================== TINYMCE WORD SETUP ===================== */
tinymce.init({
  selector:'#editor',
  height:650,
  menubar:true,
  plugins:[
    'advlist','lists','table','pagebreak','fullscreen',
    'wordcount','code','preview'
  ],
  toolbar:
    'undo redo | styles | fontfamily fontsize | bold italic underline | ' +
    'alignleft aligncenter alignright alignjustify | ' +
    'bullist numlist | table pagebreak | fullscreen',
  content_style: `
    body {
      font-family: "Times New Roman", serif;
      font-size: 12pt;
      width: 21cm;
      margin: 2.5cm;
    }
  `
});

/* ===================== OCR ===================== */
const img=document.getElementById("image");
const container=document.getElementById("imageContainer");
const selection=document.getElementById("selection");
const scanBtn=document.getElementById("scanBtn");
const statusText=document.getElementById("status");

let worker,selecting=false,startX=0,startY=0;

(async()=>{
  worker=await Tesseract.createWorker();
  await worker.loadLanguage("ind+eng");
  await worker.initialize("ind+eng");
  statusText.innerText="‚úÖ OCR siap";
})();

imageInput.onchange=e=>{
  img.src=URL.createObjectURL(e.target.files[0]);
};

container.onmousedown=e=>{
  selecting=true;
  scanBtn.classList.add("hidden");
  startX=e.offsetX;
  startY=e.offsetY;
  selection.style.display="block";
};

container.onmousemove=e=>{
  if(!selecting)return;
  selection.style.left=Math.min(startX,e.offsetX)+"px";
  selection.style.top=Math.min(startY,e.offsetY)+"px";
  selection.style.width=Math.abs(e.offsetX-startX)+"px";
  selection.style.height=Math.abs(e.offsetY-startY)+"px";
};

container.onmouseup=()=>{
  selecting=false;
  if(selection.offsetWidth>20) scanBtn.classList.remove("hidden");
};

async function scanArea(){
  statusText.innerText="‚ö° Memindai‚Ä¶";
  const sx=img.naturalWidth/img.clientWidth;
  const sy=img.naturalHeight/img.clientHeight;
  const x=selection.offsetLeft*sx;
  const y=selection.offsetTop*sy;
  const w=selection.offsetWidth*sx;
  const h=selection.offsetHeight*sy;

  const c=document.createElement("canvas");
  c.width=Math.min(w,800);
  c.height=h*(c.width/w);
  c.getContext("2d").drawImage(img,x,y,w,h,0,0,c.width,c.height);

  const {data}=await worker.recognize(c);
  tinymce.activeEditor.insertContent(data.text.replace(/\n/g,"<p></p>"));
  statusText.innerText="‚úÖ Scan selesai";
}

async function scanFull(){
  statusText.innerText="‚ö° Scan full‚Ä¶";
  const c=document.createElement("canvas");
  c.width=img.naturalWidth;
  c.height=img.naturalHeight;
  c.getContext("2d").drawImage(img,0,0);
  const {data}=await worker.recognize(c);
  tinymce.activeEditor.setContent(data.text.replace(/\n/g,"<p></p>"));
  statusText.innerText="‚úÖ Scan selesai";
}

/* ===================== FORMAT MAKALAH ===================== */
function formatMakalah(){
  tinymce.activeEditor.getBody().style.lineHeight="1.5";
  tinymce.activeEditor.getBody().style.textAlign="justify";
}

/* ===================== EXPORT ===================== */
function downloadPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF("p","mm","a4");
  pdf.text(
    tinymce.activeEditor.getContent({format:"text"}),
    20,20
  );
  pdf.save("dokumen-ocr.pdf");
}

function downloadDOCX(){
  const text=tinymce.activeEditor.getContent({format:"text"});
  const doc=new docx.Document({
    sections:[{
      headers:{default:new docx.Header({
        children:[new docx.Paragraph("Smart OCR Lens")]
      })},
      footers:{default:new docx.Footer({
        children:[new docx.Paragraph("Halaman")]
      })},
      children:text.split("\n").map(t=>
        new docx.Paragraph({
          children:[new docx.TextRun({
            text:t,
            font:"Times New Roman",
            size:24
          })],
          spacing:{line:360}
        })
      )
    }]
  });
  docx.Packer.toBlob(doc).then(b=>saveAs(b,"dokumen-ocr.docx"));
}

function resetAll(){
  tinymce.activeEditor.setContent("");
  selection.style.display="none";
}
</script>

</body>
</html>
