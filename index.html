<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart OCR Lens</title>

<!-- OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<!-- Editor -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

<!-- Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
* { box-sizing:border-box }
body {
  font-family: system-ui, Arial;
  background: linear-gradient(180deg,#f5f7fa,#e4ecf5);
  margin:0;
  padding:12px;
}
.container {
  max-width: 720px;
  margin:auto;
}
h1 {
  text-align:center;
  margin-bottom:10px;
}
.card {
  background:#fff;
  border-radius:14px;
  padding:12px;
  margin-bottom:12px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
#imageContainer {
  position:relative;
  border-radius:12px;
  overflow:hidden;
  background:#000;
  touch-action:none;
}
#image {
  width:100%;
  display:block;
}
#selection {
  position:absolute;
  border:2px solid #00e5ff;
  background:rgba(0,229,255,.25);
  display:none;
}
input[type=file] {
  width:100%;
  padding:10px;
}
button {
  width:100%;
  padding:12px;
  margin-top:8px;
  border:none;
  border-radius:10px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}
.scan { background:#007bff; color:#fff }
.word { background:#28a745; color:#fff }
.pdf  { background:#dc3545; color:#fff }
button:active { transform:scale(.98) }

#status {
  text-align:center;
  font-size:14px;
  margin-top:6px;
  color:#555;
}
textarea {
  width:100%;
  height:90px;
  margin-top:8px;
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
}
#editor {
  height:220px;
  background:#fff;
  border-radius:10px;
}
.footer {
  text-align:center;
  font-size:12px;
  color:#888;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="container">

<h1>üì∏ Smart OCR Lens</h1>

<div class="card">
  <input type="file" accept="image/*" id="imageInput">
</div>

<div class="card">
  <div id="imageContainer">
    <img id="image">
    <div id="selection"></div>
  </div>
</div>

<div class="card">
  <button class="scan" onclick="scanArea()">üîç Scan Area</button>
  <button class="word" onclick="exportWord()">‚¨áÔ∏è Download Word</button>
  <button class="pdf" onclick="exportPDF()">‚¨áÔ∏è Download PDF</button>
  <div id="status">‚è≥ Menyiapkan OCR engine‚Ä¶</div>
</div>

<div class="card">
  <textarea id="ocrResult" placeholder="Hasil teks mentah (opsional)..."></textarea>
</div>

<div class="card">
  <div id="editor"></div>
</div>

<div class="footer">
  Smart OCR Lens ‚Ä¢ Scan ‚Üí Edit ‚Üí Download
</div>

</div>

<script>
const img = document.getElementById("image");
const container = document.getElementById("imageContainer");
const selection = document.getElementById("selection");
const statusText = document.getElementById("status");
const ocrResult = document.getElementById("ocrResult");
const quill = new Quill('#editor', { theme:'snow' });

let startX=0,startY=0,selecting=false;
let worker;

// Init OCR once
(async()=>{
  worker = await Tesseract.createWorker();
  await worker.loadLanguage("ind+eng");
  await worker.initialize("ind+eng");
  statusText.innerText="‚úÖ OCR siap digunakan";
})();

imageInput.onchange = e => {
  img.src = URL.createObjectURL(e.target.files[0]);
};

function getPos(e){
  const r=container.getBoundingClientRect();
  const p=e.touches?e.touches[0]:e;
  return {x:p.clientX-r.left,y:p.clientY-r.top};
}

container.addEventListener("touchstart",start);
container.addEventListener("mousedown",start);
function start(e){
  e.preventDefault();
  selecting=true;
  const p=getPos(e);
  startX=p.x;startY=p.y;
  selection.style.display="block";
  selection.style.left=startX+"px";
  selection.style.top=startY+"px";
  selection.style.width=0;
  selection.style.height=0;
}

container.addEventListener("touchmove",move);
container.addEventListener("mousemove",move);
function move(e){
  if(!selecting)return;
  const p=getPos(e);
  selection.style.left=Math.min(startX,p.x)+"px";
  selection.style.top=Math.min(startY,p.y)+"px";
  selection.style.width=Math.abs(p.x-startX)+"px";
  selection.style.height=Math.abs(p.y-startY)+"px";
}

container.addEventListener("touchend",()=>selecting=false);
container.addEventListener("mouseup",()=>selecting=false);

async function scanArea(){
  if(selection.offsetWidth<10) return alert("Blok area teks dulu");
  statusText.innerText="‚è≥ Scan area‚Ä¶";

  const sx=img.naturalWidth/img.clientWidth;
  const sy=img.naturalHeight/img.clientHeight;
  const x=selection.offsetLeft*sx;
  const y=selection.offsetTop*sy;
  const w=selection.offsetWidth*sx;
  const h=selection.offsetHeight*sy;

  const c=document.createElement("canvas");
  c.width=w;c.height=h;
  c.getContext("2d").drawImage(img,x,y,w,h,0,0,w,h);

  const { data } = await worker.recognize(c);
  const text=data.text.trim();

  ocrResult.value+=text+"\n";
  quill.insertText(quill.getLength(),text+"\n");
  statusText.innerText="‚úÖ Scan selesai";
}

function exportWord(){
  const text=quill.getText().trim();
  if(!text)return alert("Teks kosong");
  const paras=text.split("\n").filter(p=>p.trim());
  const doc=new docx.Document({
    sections:[{children:paras.map(p=>new docx.Paragraph({
      spacing:{after:200},
      children:[new docx.TextRun({text:p,font:"Times New Roman",size:24})]
    }))}]
  });
  docx.Packer.toBlob(doc).then(b=>saveAs(b,"hasil-ocr.docx"));
}

function exportPDF(){
  const { jsPDF }=window.jspdf;
  const text=quill.getText().trim();
  if(!text)return alert("Teks kosong");
  const pdf=new jsPDF();
  const lines=pdf.splitTextToSize(text,180);
  pdf.text(lines,10,10);
  pdf.save("hasil-ocr.pdf");
}
</script>

</body>
</html>
